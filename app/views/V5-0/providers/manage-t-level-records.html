{% extends "layout.html" %}

{% block pageTitle %}
    Manage T Level records - Manage T Level results - GOV.UK
{% endblock %}

{% block beforeContent %}
    <nav>
        <div class="govuk-breadcrumbs">
            <ol class="govuk-breadcrumbs__list">
                <li class="govuk-breadcrumbs__list-item">
                    <a class="govuk-breadcrumbs__link" href="tlevels-dashboard">Home</a>
                </li>
                <li class="govuk-breadcrumbs__list-item">
                    <a class="govuk-breadcrumbs__link" href="search-learner-records.html">Search learner records</a>
                </li>
            </ol>
        </div>
    </nav>
{% endblock %}

{% set 2020to2021learners = 0 %}
{% set 2021to2022learners = 0 %}
{% for value in tLevelsStudentData %}
    {% if value['learnerStartYear'] == '2020 to 2021' %}
        {% set 2020to2021learners = 2020to2021learners+1 %}
    {% else %}
        {% set 2021to2022learners = 2021to2022learners+1 %}
    {% endif %}
{% endfor %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if data['learnerStartYear'] == '2020 to 2021' %}
                <h1 class="govuk-heading-l">Registered Learners ({{2020to2021learners}})</h1>
            {% else %}
                <h1 class="govuk-heading-l">Registered Learners ({{2021to2022learners}})</h1>
            {% endif %}
        </div>
    </div>

    <div class="govuk-grid-row v5">
        <div class="govuk-grid-column-one-third">
            <div class="filter-border">
                <h2 class="govuk-heading-m govuk-!-padding-top-4">Filters</h2>

                <div id="selectedFiltersWrapper" class="govuk-visually-hidden govuk-!-margin-bottom-6">
                    <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Selected filters</h3>
                    <div id="selectedFilters"></div>
                </div>

                <button class="govuk-button" onclick="applyFilters()">Apply filters</button>
                <button class="govuk-button govuk-button--secondary govuk-visually-hidden " id="clearFilters"
                        onclick="clearFilters()">Clear filters
                </button>
                <div class="govuk-form-group">
                    <fieldset class="govuk-fieldset">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                            Incomplete
                        </legend>
                        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
                            <div class="govuk-checkboxes__item govuk-checkboxes--small">
                                <input class="govuk-checkboxes__input"
                                       id="english"
                                       name="status"
                                       type="checkbox"
                                       data-filterVal="english"
                                       value="English">
                                <label class="govuk-label govuk-checkboxes__label" for="english">
                                    English level
                                </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes--small">
                                <input class="govuk-checkboxes__input"
                                       id="maths"
                                       name="status"
                                       type="checkbox"
                                       data-filterVal="maths"
                                       value="Maths">
                                <label class="govuk-label govuk-checkboxes__label" for="maths">
                                    Maths level
                                </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes--small">
                                <input class="govuk-checkboxes__input"
                                       id="industry-placement"
                                       name="status"
                                       type="checkbox"
                                       data-filterVal="industry-placement"
                                       value="Industry placement">
                                <label class="govuk-label govuk-checkboxes__label" for="industry-placement">
                                    Industry placement
                                </label>
                            </div>
                            <div class="govuk-checkboxes__item govuk-checkboxes--small">
                                <input class="govuk-checkboxes__input"
                                       id="all-incomplete"
                                       name="status"
                                       type="checkbox"
                                       data-filterVal="incomplete"
                                       value="All incomplete">
                                <label class="govuk-label govuk-checkboxes__label" for="all-incomplete">
                                    All incomplete records
                                </label>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="govuk-form-group">
                    <fieldset class="govuk-fieldset">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                            T Level
                        </legend>
                        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
                            {% set filterLabels = [] %}
                            {% for value in tLevelsStudentData %}
                                {% if value.learnerStartYear == data.learnerStartYear %}
                                    {% if value.learnerTLevelTitle in filterLabels %}
                                    {% else %}
                                        {% set filterLabels = (filterLabels.push(value.learnerTLevelTitle), filterLabels) %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}

                            {% for filterLabel in filterLabels %}

                                <div class="govuk-checkboxes__item govuk-checkboxes--small">
                                    <input class="govuk-checkboxes__input"
                                           id="{{ filterLabel  | lower  | replace(' ', '-') |replace('&#44;', '') }}"
                                           name="t-level"
                                           type="checkbox"
                                           value="{{ filterLabel  | safe }}"
                                           data-filterVal="{{ filterLabel  | lower  | replace(' ', '-') | replace('&#44;', '') }}">
                                    <label class="govuk-label govuk-checkboxes__label"
                                           for="{{ filterLabel  | lower  | replace(' ', '-') | replace('&#44;', '') }}">
                                        {{ filterLabel | safe }}
                                    </label>
                                </div>
                            {% endfor %}

                        </div>
                    </fieldset>
                </div>
            </div>

        </div>
        <div class="govuk-grid-column-two-thirds">
            <div class="govuk-form-group govuk-!-margin-bottom-6">
                <label class="govuk-label app-search__label govuk-label--m" for="keywords">
                    Search by learner last name or ULN
                </label>
                <input class="govuk-input app-search__input govuk-input--width-20" id="keywords" name="keywords"
                       type="search">
                <button type="button"
                        class="govuk-button app-search__button govuk-!-margin-bottom-2 govuk-!-margin-right-1"
                        data-module="govuk-button" id="searchButton" onclick="search()">
                    Search
                </button>
                <button id="clearSearch"
                        class="govuk-button govuk-!-margin-bottom-2 govuk-button--secondary govuk-visually-hidden"
                        onclick="clearSearch()">Clear search
                </button>
                </p>
            </div>

            <div class="moj-filter-layout__content" id="records-list">

                <div class="app-records-actions" id="sortAndExport">
                    <div class="app-records-actions__col">
                        <p class="govuk-visually-hidden">Records sorted by </p>
                        <p class="govuk-body govuk-!-margin-bottom-3">
                            <span class="govuk-!-font-weight-bold govuk-!-margin-right-1">Sort by last name:</span>
                            {% if data['sortOrder'] == 'z-to-a' %}
                                <a href="?sortOrder=a-to-z" class="govuk-link govuk-link--no-visited-state">A to Z</a> |
                                Z to A
                            {% else %}
                                A to Z |
                                <a href="?sortOrder=z-to-a" class="govuk-link govuk-link--no-visited-state">Z to A</a>
                            {% endif %}
                        </p>
                    </div>
                </div>
                <!--Creates a variable called page and assigns the current page url to be its value, then makes it a float so that it can be summed-->
                {% set Page = data['page'] %}
                {% set Page = Page | float %}
                {% if data['learnerStartYear'] == '2020 to 2021' and Page == 1 %}
                    <div class="govuk-body">
                        Viewing 1 - 10 of {{2020to2021learners}} learners
                    </div>
                {% elif data['learnerStartYear'] == '2020 to 2021' %}
                    <div class="govuk-body">
                        {% set Page = Page-1 %}
                        Viewing {{Page*10+1}} - {% if 2020to2021learners < Page*10+10 %} {{2020to2021learners}} {% else %} {{Page*10+10}} {% endif %} of {{2020to2021learners}} learners
                    </div>
                {% elif data['learnerStartYear'] == '2021 to 2022' and Page == 1 %}
                    <div class="govuk-body">
                        Viewing 1 - 10 of {{2021to2022learners}} learners
                    </div>
                {% else %}
                    <div class="govuk-body">
                        {% set Page = Page-1 %}
                        Viewing {{Page*10+1}} - {% if 2021to2022learners < Page*10+10 %} {{2021to2022learners}} {% else %} {{Page*10+10}} {% endif %} of {{2021to2022learners}} learners
                    </div>
                {% endif %}

                <div id="results" class="learner-records">
                    {% include "../includes/overall-results/overall-results-learner-data.html" %}
                    <div id="no-results" class="govuk-!-display-none">
                        {% include "../includes/overall-results/no-results.html" %}
                    </div>
                </div>

                {% set Page = data['page'] %}
                {% set Page = Page | float %}
                <div id="paginationId" class="pagination govuk-body">
                    {% if data['learnerStartYear'] == '2020 to 2021' %}
                        <ul class="pagination__list-items govuk-!-text-align-centre govuk-!-padding-left-0">
                            {% if data['page'] == '1' %}
                            <li class="pagination__item app-float-left" id="previousButton">
                                <span class="pagination__link--hidden" aria-hidden="true" role="presentation">&#171; Previous page</span>
                            </li>
                            {% else %}
                            <li class="pagination__item app-float-left" id="previousButton">
                                <a href="?page={{Page-1}}" class="pagination__link" role="presentation">&#171; Previous page</a>
                            </li>
                            {% endif %}
                            <!--This code creates a variable that gives us a number equal to the amount of total pages needed to fit all the data -->
                            {% if data['learnerStartYear'] == '2020 to 2021' %}
                                {% set totalLearners = 2020to2021learners + 9 %}
                                {% set totalLearners = totalLearners/10 %}
                                {% set totalLearners = totalLearners//1 %}
                            {% else %}
                                {% set totalLearners = 2021to2022learners + 9 %}
                                {% set totalLearners = totalLearners/10 %}
                                {% set totalLearners = totalLearners//1 %}
                            {% endif %}

                            {% for i in range(0, totalLearners) %}
                            <li class="pagination__item">
                                <a class="pagination__link govuk-!-font-weight-bold
                                {% if i+1 != Page %}govuk-link--no-visited-state {% endif %}
                                {% if i+1 == Page %}govuk-link--text-colour{% endif %}"
                                   href="?page={{i+1}}">
                                    {{i+1}}
                                </a>
                            </li>
                            {% endfor %}
                            {% if Page == totalLearners-1 %}
                            <li class="pagination__item app-float-right" id="nextButton">
                                <a class="pagination__link" href="?page={{Page+1}}">
                                    Next page
                                    <span aria-hidden="true" role="presentation">&#187;</span>
                                </a>
                            </li>
                        </ul>
                            {% else %}
                            <li class="pagination__item app-float-right" id="nextButton">
                                <span class="pagination__link--hidden" aria-hidden="true" role="presentation">Next page &#187;</span>
                            </li>
                        </ul>
                    {% endif %}
                    {% else %}
                    {% endif %}
                    {% if data['learnerStartYear'] == '2020 to 2021' and Page == 1 %}
                        <div class="govuk-!-display-inline dis govuk-body">
                            Viewing 1 - 10 of {{2020to2021learners}} learners
                        </div>
                    {% elif data['learnerStartYear'] == '2020 to 2021' %}
                        <div class="govuk-!-display-inline dis govuk-body">
                            {% set Page = Page-1 %}
                            Viewing {{Page*10+1}} - {% if 2020to2021learners < Page*10+10 %} {{2020to2021learners}} {% else %} {{Page*10+10}} {% endif %} of {{2020to2021learners}} learners
                        </div>
                    {% elif data['learnerStartYear'] == '2021 to 2022' and Page == 1  %}
                        <div class="govuk-!-display-inline dis govuk-body">
                            Viewing 1 - 10 of {{2021to2022learners}} learners
                        </div>
                    {% else %}
                    <div class="govuk-!-display-inline dis govuk-body">
                        {% set Page = Page-1 %}
                        Viewing {{Page*10+1}} - {% if 2021to2022learners < Page*10+10 %} {{2021to2022learners}} {% else %} {{Page*10+10}} {% endif %} of {{2021to2022learners}} learners
                    </div>
                    {% endif %}
                    <div class="govuk-button-group govuk-!-margin-top-2">
                        <a id="searchAgainButton" class="govuk-button" role="button" href="./search-learner-records">Search
                            learner records</a>
                        <a id="backToHomeButton" class="govuk-button govuk-button--secondary" role="button"
                           data-module="govuk-button" href="./tlevels-dashboard.html">Back to home</a>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="/public/javascripts/overall-results.js"></script>
{% endblock %}

